name: Build EclipseGS

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  BUILD_TYPE: Release

jobs:

  build-linux:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install system packages
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            cmake g++ make \
            qt6-base-dev qt6-tools-dev \
            libsdl2-dev

      - name: Configure CMake
        run: cmake -S . -B build -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}

      - name: Build
        run: cmake --build build --config $BUILD_TYPE --parallel

  build-windows:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install Qt
        uses: jurplel/install-qt-action@v4   
        with:
          version: '6.7.2'               
          host: 'windows'
          target: 'desktop'
          arch: 'win64_msvc2022_64'
          tools: 'tools_windeployqt'       

      - name: Configure CMake (MSVC 2022)
        run: |
          cmake -S . -B build ^
                -G "Visual Studio 17 2022" ^
                -DCMAKE_BUILD_TYPE=${{ env.BUILD_TYPE }}

      - name: Build
        run: cmake --build build --config %BUILD_TYPE% --parallel
